<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Test /add_skill & /delete_skill_by_user</title>
</head>
<body>
  <h1>Test /add_skill</h1>

  <!-- ========== 添加 Skill 表单 ========== -->
  <form id="skillForm">
    <div>
      <label for="username">Username:</label>
      <input type="text" id="username" name="username" placeholder="如：rex">
    </div>
    <br>
    <div>
      <label for="skillname">Skill name:</label>
      <input type="text" id="skillname" name="skillname" placeholder="如：写作">
    </div>
    <br>
    <div>
      <label for="proficiency">Proficiency:</label>
      <input type="number" id="proficiency" name="proficiency" placeholder="如：2">
    </div>
    <br>
    <button type="submit">添加 Skill</button>
  </form>

  <hr>

  <h1>Test /delete_skill_by_user</h1>

  <!-- ========== 删除 Skill 表单 ========== -->
  <form id="deleteSkillForm">
    <div>
      <label for="del_username">Username:</label>
      <input type="text" id="del_username" name="del_username" placeholder="如：rex">
    </div>
    <br>
    <div>
      <label for="del_skillname">Skill name:</label>
      <input type="text" id="del_skillname" name="del_skillname" placeholder="如：写作">
    </div>
    <br>
    <button type="submit">删除 Skill</button>
  </form>

  <!-- JavaScript 匿名脚本 -->
  <script>
    // ===================== 添加 Skill =====================
    document.getElementById('skillForm').addEventListener('submit', function(e) {
      // 阻止表单的默认提交动作
      e.preventDefault();

      // 1. 获取输入框的内容
      const username = document.getElementById('username').value;
      const skillname = document.getElementById('skillname').value;
      const proficiency = parseInt(document.getElementById('proficiency').value, 10);

      // 2. 组织成 JSON 对象
      const payload = {
        username: username,
        skillname: skillname,
        proficiency: proficiency
      };

      // 3. 使用 fetch 以 POST 方式发送 JSON
      fetch('https://18.183.175.8/add_skill', {  // TODO: 替换为自己服务器的域名或地址
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      })
      .then(response => {
        // 这里可以先检查 HTTP 状态码
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        // 如果后端返回的是 JSON
        return response.json();
      })
      .then(data => {
        // 4. 处理后端返回的 JSON 数据
        console.log('添加 Skill 接口返回: ', data);
        alert('添加 Skill 接口返回: ' + JSON.stringify(data));
      })
      .catch(error => {
        console.error(error);
        alert('出现错误: ' + error);
      });
    });


    // ===================== 删除 Skill =====================
    document.getElementById('deleteSkillForm').addEventListener('submit', function(e) {
      // 阻止表单的默认提交动作
      e.preventDefault();

      // 1. 获取输入框的内容
      const username = document.getElementById('del_username').value;
      const skillname = document.getElementById('del_skillname').value;

      // 2. 组织成 JSON 对象（要发给后端的请求体）
      const payload = {
        skillname: skillname
      };

      // 3. 使用 fetch 以 POST 方式发送 JSON
      // 注意这里路径最后要加上 `/delete_skill_by_user/<username>`，
      //   路由里 <username> 就由变量 username 替换。
      fetch(`https://18.183.175.8/delete_skill_by_user/${username}`, {  // TODO: 替换为实际域名或地址
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      })
      .then(response => {
        // 这里先检查 HTTP 状态码
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        // 4. 处理后端返回的 JSON 数据
        console.log('删除 Skill 接口返回:', data);
        alert('删除 Skill 接口返回: ' + JSON.stringify(data));
      })
      .catch(error => {
        console.error(error);
        alert('出现错误: ' + error);
      });
    });
  </script>
</body>
</html>